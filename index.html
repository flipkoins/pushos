<!DOCTYPE html>
<html lang="en">
<head>
    <title>BookMyLivestock | Notification</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/16.png" type="image/png" sizes="16x16">
<link rel="icon" href="/32.png"  type="image/png" sizes="32x32" />

</head>
<body style="
    text-align: center;
    padding: 100px 50px;
">
    <img src="/android-launchericon-192-192.png" alt="Logo">
<h1 style="
    padding-top: 20px;
    margin: auto;
    text-align: center;
    /* margin-top: 50px; */
    line-height: 81px;
">கால்நடைகளின் தகவல், விலை விவரம், விற்பனை பதிவு போன்றவற்றை தெரிந்து கொள்ள வேண்டுமா? "Enable Notification" என்பதைக் கிளிக் செய்து, பின்னர் "Allow" என்பதை தேர்வு செய்யுங்கள்.</h1>
    <button id="subscribeNow" style="
    margin-top: 60px;
    font-size: 47px;
    padding: 34px 111px;
    background: #05a884;
    color: white;
    border: none;
">Enable Notification</button>
<script>
  // Listen for messages from the main domain
  window.addEventListener("message", (event) => {
    if (event.origin !== "https://www.bookmylivestock.com") return;

    if (event.data.action === "subscribeToPush") {
      if ("Notification" in window) {
        if (Notification.permission === "granted") {
          console.log("Notifications are enabled");
        } else if (Notification.permission === "default") {
          Notification.requestPermission().then((permission) => {
            if (permission === "granted") {
              window.OneSignalDeferred = window.OneSignalDeferred || [];
                OneSignalDeferred.push(function(OneSignal) {
                  OneSignal.init({
                    appId: "84c7596a-6657-4ac8-9039-aab9f2237940"
                  }).then(() => {
                    console.log("OneSignal initialized successfully.");
                    // Additional tasks after initialization
                    window.opener.postMessage({ action: 'subscriptionSuccess' }, 'https://www.bookmylivestock.com');
                    return OneSignal.getUserId();
                  }).then((userId) => {
                    console.log("User ID:", userId);
                  }).catch((error) => {
                    window.opener.postMessage({ action: 'subscriptionFailed' }, 'https://www.bookmylivestock.com');
                    console.error("Error initializing OneSignal:", error);
                  });
                });
            } else {
              window.opener.postMessage({ action: 'subscriptionFailed' }, 'https://www.bookmylivestock.com');
              console.log("User denied permission");
            }
          });
        } else {
          window.opener.postMessage({ action: 'subscriptionFailed' }, 'https://www.bookmylivestock.com');
          console.log("Notifications are blocked");
        }
      } else {
        window.opener.postMessage({ action: 'subscriptionFailed' }, 'https://www.bookmylivestock.com');
        console.log(
          "Notifications are not supported on this device or browser."
        );
      }
    }
  });
</script>
</body>
</html>
